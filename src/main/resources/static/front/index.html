<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="pragma" content="no-cache"/>
    <meta http-equiv="content-type" content="no-cache, must-revalidate"/>
    <meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT"/>
    <title>é¦–é¡µ</title>
    <link href="css/swiper-5.4.5/swiper.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/my.css" rel="stylesheet">
    <link href="css/nav.css" rel="stylesheet">

    <style>

        .notice-box li {
            float: left;
            text-align: center;
        }

        .notice-box li img {
            width: 100%
        }

        /* æŠ½å¥–è£…ç½®æ ·å¼ */
        .lottery-container {
            width: 1000px; /* 5ä¸ªå¡ç‰‡å®½åº¦ */
            margin: 0 auto;
            overflow: hidden;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .lottery-track {
            display: flex;
            transition: transform 0.1s linear;
            height: 100%;
            width: max-content; /* æ–°å¢ï¼šè®©è½¨é“å®½åº¦è‡ªé€‚åº”å†…å®¹ */
        }

        .lottery-item {
            flex-shrink: 0;
            width: 200px;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
        }

        .lottery-card {
            background: white;
            border-radius: 10px;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            overflow: hidden;
        }

        .lottery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .lottery-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 10px 10px 0 0;
        }

        .lottery-name {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #333;
            font-size: 14px;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Swiperè‡ªå®šä¹‰å·¦å³ç®­å¤´æŒ‰é’®æ ·å¼ */
        .swiper-button-prev, .swiper-button-next {
            width: 48px;
            height: 80px;
            color: #fff;
            background: rgba(0,0,0,0); /* é»˜è®¤æ— åº•è‰² */
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            font-size: 32px;
        }

        .swiper-button-prev:after, .swiper-button-next:after {
            font-size: 32px;
            font-weight: bold;
        }

        .swiper-button-prev:hover, .swiper-button-next:hover {
            background: rgba(0,0,0,0.6); /* æ‚¬åœæ—¶é»‘è‰²åŠé€æ˜ */
            border-radius: 16px;
        }

        .swiper-button-prev,
        .swiper-button-next {
            top: 54% !important;  /* ä½ å¯ä»¥å°è¯•52%ã€54%ã€55%ç­‰ï¼Œç›´åˆ°æ»¡æ„ä¸ºæ­¢ */
            transform: translateY(-50%) !important;
        }
        .swiper-button-prev {
            left: 10px !important;
        }
        .swiper-button-next {
            right: 10px !important;
        }

        /* Swiperåˆ†é¡µå™¨æ¨ªæ¡æ ·å¼ */
        .swiper-pagination-bullet {
            width: 32px;
            height: 6px;
            display: inline-block;
            border-radius: 3px;
            background: #888;
            opacity: 1;
            margin: 0 4px !important;
            transition: background 0.3s;
        }

        .swiper-pagination-bullet-active {
            background: #fff;
        }

        .simple-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
            background: linear-gradient(to bottom, #961E19 0%, #b03a3a 60%, #e05a47 100%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            padding: 0 40px;
            font-family: 'Segoe UI', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-logo {
            height: 38px;
            margin-right: 12px;
        }

        .header-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #961E19;
            letter-spacing: 2px;
        }

        .header-nav {
            display: flex;
            gap: 28px;
        }

        .header-nav a {
            color: #333;
            font-size: 1em;
            text-decoration: none;
            padding: 4px 0;
            transition: color 0.2s;
        }

        .header-nav a:hover {
            color: #b03a3a;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .header-right a, .header-right span {
            color: #666;
            font-size: 1em;
            text-decoration: none;
            transition: color 0.2s;
        }

        .header-right a:hover {
            color: #b03a3a;
        }
        .header-title,
        .header-nav a,
        .header-right a,
        .header-right span {
            color: #fff;
        }
        .header-nav a:hover,
        .header-right a:hover {
            color: #ffe082;
        }
    </style>
</head>
<body>

<div id="wrapper" style="padding-bottom: 20px">
    <div class="container">
        <!-- å¤´éƒ¨å¼€å§‹ -->
        <div class="simple-header">
            <div class="header-left">
                <img src="../file/æ–°å¤§logo.png" alt="logo" class="header-logo">
                <span class="header-title">æ ¡å›­é£Ÿå ‚è®ºå›</span>
            </div>
            <div class="header-nav">
                <a href="index.html">é¦–é¡µ</a>
                <a href="advertiserInfo.html">ç³»ç»Ÿå…¬å‘Š</a>
                <a href="foodsMenuInfo.html">èœè°±</a>
                <a href="collectInfo.html">æ”¶è—</a>
                <a href="notesInfo.html">ç¬”è®°</a>
                <a href="newsInfo.html">é¥®é£Ÿèµ„è®¯</a>
                <a href="messageInfo.html">ä»Šæ—¥è¯é¢˜</a>
                <a v-if="isShow" href="/end/page/index.html" target="_blank">ç®¡ç†</a>
            </div>
            <div class="header-right">
                <a v-if="!(user.name)" href="/end/page/login.html" target="_blank">ç™»å½•</a>
                <a v-if="!(user.name)" href="/end/page/register.html" target="_blank">æ³¨å†Œ</a>
                <span v-if="user.name">æ¬¢è¿æ‚¨ï¼Œ{{user.name}}</span>
                <a v-if="user.name" href="javascript:void(0)" @click="logout">é€€å‡º</a>
            </div>
        </div>
        <!-- å¤´éƒ¨ç»“æŸ -->


    </div>

    <div class="container" style="margin-top: 5px">
        <div class="col-md-12">
            <div class="row">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide"><img class="carousel-img" src="/front/img/carousel/1.jpg" alt=""></div>
                        <div class="swiper-slide"><img class="carousel-img" src="/front/img/carousel/2.jpg" alt=""></div>
                        <div class="swiper-slide"><img class="carousel-img" src="/front/img/carousel/3.jpg" alt=""></div>
                        <div class="swiper-slide"><img class="carousel-img" src="/front/img/carousel/4.jpg" alt=""></div>
                    </div>
                    <!-- å¦‚æœéœ€è¦åˆ†é¡µå™¨ -->
                    <div class="swiper-pagination"></div>
                    <!-- å¦‚æœéœ€è¦å¯¼èˆªæŒ‰é’® -->
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
            </div>
        </div>
    </div>


    <div class="container">
        <div style="padding: 20px; font-size: 20px; color: orangered"><b>ğŸ¤©æ¯æ—¥ç²¾é€‰èœè°±</b></div>
        <!--èœè°±-->
        <div>
            <div style="width: 25%; display: inline-block; padding: 10px; text-align: center" v-for="item in tableData" :key="item.id">
                <a :href="'foodsMenuInfoDetail.html?id='+item.id">
                    <img style="width: 100%; height: 180px; border-radius: 10px" :src='"/files/download/" + item.fileId' alt="">
                </a>
                <div style="padding-top: 10px"><b>{{item.name}}</b></div>
                <div> #{{item.tips}}# {{item.description}}</div>
            </div>
        </div>

        <!-- ä»Šå¤©åƒä»€ä¹ˆæŠ½å¥–è£…ç½® -->
        <div style="padding: 20px; font-size: 20px; color: orangered"><b>ğŸ¤”ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</b></div>
        <div style="background: radial-gradient(circle at 50% 50%, #f7b5a3 0%, #e05a47 60%, #b03a3a 100%); padding: 30px; border-radius: 15px; margin: 20px 0;">
            <div style="text-align: center; margin-bottom: 20px;">
                <button @click="startLottery" :disabled="isLotteryRunning"
                        style="background: #b03a3a; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s;"
                        :style="isLotteryRunning ? 'opacity: 0.6; cursor: not-allowed;' : 'box-shadow: 0 4px 15px rgba(176, 58, 58, 0.3);'">
                    {{ isLotteryRunning ? 'æŠ½å¥–ä¸­...' : 'å¼€å§‹æŠ½å¥–' }}
                </button>
            </div>

            <div class="lottery-container">
                <div class="lottery-track" :style="{ transform: 'translateX(' + lotteryOffset + 'px)' }">
                    <a :href="'foodsMenuInfoDetail.html?id=' + item.id" target="_blank" class="lottery-item" v-for="(item, index) in displayLotteryItems" :key="index" style="text-decoration: none; color: inherit;">
                        <div class="lottery-card">
                            <img :src="'/files/download/' + item.fileId" :alt="item.name" class="lottery-img">
                            <div class="lottery-name">{{ item.name }}</div>
                        </div>
                    </a>
                </div>
            </div>

            <div v-if="selectedFood" style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.9); border-radius: 10px;">
                <h3 style="color: #333; margin: 0;">ğŸ‰ ä»Šå¤©åƒè¿™ä¸ªå§ï¼</h3>
                <p style="color: #666; margin: 10px 0 0 0;">{{ selectedFood.name }}</p>
            </div>
        </div>

        <!-- é£Ÿæ -->
        <div style="padding: 20px; font-size: 20px; color: orangered"><b>çƒ­é—¨é£Ÿæ</b></div>
        <!--é£Ÿæ-->
        <div>
            <div style="width: 20%; display: inline-block; padding: 10px; text-align: center" v-for="item in materialTableData" :key="item.id">
                <a :href="'foodsMaterialInfoDetail.html?id='+item.id">
                    <img style="width: 100%; height: 180px; border-radius: 10px" :src='"/files/download/" + item.fileId' alt="">
                </a>
                <div style="padding-top: 10px"><b>{{item.name}}</b></div>
            </div>
        </div>
    </div>
</div>

<!--jsåº“æ–‡ä»¶-->
<script src="js/jquery-1.10.2.js"></script>
<script src="js/vue2.6.11/axios.js"></script>
<script src="js/vue2.6.11/vue.min.js"></script>
<script src="js/swiper-5.4.5/swiper.min.js"></script>


<script>
    $(function () {
        var mySwiper = new Swiper('.swiper-container', {
            // direction: 'vertical', // å‚ç›´åˆ‡æ¢é€‰é¡¹
            autoplay: {
                delay: 5000,
                disableOnInteraction: false
            },//å¯é€‰é€‰é¡¹ï¼Œè‡ªåŠ¨æ»‘åŠ¨
            loop: true, // å¾ªç¯æ¨¡å¼é€‰é¡¹
            speed: 2000,

            // å¦‚æœéœ€è¦åˆ†é¡µå™¨
            pagination: {
                el: '.swiper-pagination',
                clickable: true
            },

            // å¦‚æœéœ€è¦å‰è¿›åé€€æŒ‰é’®
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev'
            }
        });

        // é¼ æ ‡ç§»å…¥åœæ­¢è‡ªåŠ¨æ»šåŠ¨
        var $swiperSide = $('.swiper-slide');
        $swiperSide.mouseenter(function () {
            mySwiper.autoplay.stop();
        });
        // é¼ æ ‡ç§»å‡ºå¼€å§‹è‡ªåŠ¨æ»šåŠ¨
        $swiperSide.mouseleave(function () {
            mySwiper.autoplay.start();
        });
    });

    new Vue({
        el: '#wrapper',
        data: {
            tableData: [],  // èœè°±æ•°æ®
            materialTableData: [],  // é£Ÿææ•°æ®
            activeIndex: 0,
            user: {},
            isShow: false,
            date: null,
            isLotteryRunning: false, // æŠ½å¥–æ˜¯å¦æ­£åœ¨è¿è¡Œ
            lotteryItems: [], // æŠ½å¥–ç‰©å“åˆ—è¡¨
            selectedFood: null, // é€‰ä¸­çš„é£Ÿç‰©
            lotteryOffset: 0, // æŠ½å¥–è½¨é“åç§»é‡
            lotteryInterval: null // æŠ½å¥–å®šæ—¶å™¨
        },
        computed: {
            displayLotteryItems() {
                // æ¸²æŸ“äº”è½®å¥–æ± å†…å®¹ï¼Œé˜²æ­¢è½¬åŠ¨æ—¶å‡ºç°ç©ºç™½
                return [
                    ...this.lotteryItems,
                    ...this.lotteryItems,
                    ...this.lotteryItems,
                    ...this.lotteryItems,
                    ...this.lotteryItems
                ];
            }
        },
        created: function () {
            axios.get('/auth').then(res => {
                if (res.data.code === '0') {
                    this.user = res.data.data;
                    if (this.user.level !== 3) {
                        this.isShow = true;
                    }
                }
            });

            this.loadTable();
            this.loadMaTable();
            this.loadLotteryItems(); // åŠ è½½æŠ½å¥–ç‰©å“
        },
        methods: {
            loadTable() {
                axios.get("/foodsMenuInfo/page/all?" + "pageSize=8").then(res => {
                    if (res.data.code === '0') {
                        this.tableData = res.data.data.list;
                    } else {
                        alert(res.data.msg);
                    }
                });
            },
            loadMaTable() {
                axios.get("/foodsMaterialInfo/page/all?pageSize=10").then(res => {
                    if (res.data.code === '0') {
                        this.materialTableData = res.data.data.list;
                    } else {
                        alert(res.data.msg);
                    }
                });
            },
            loadLotteryItems() {
                axios.get("/foodsMenuInfo/page/all?pageSize=100").then(res => {
                    if (res.data.code === '0') {
                        let items = res.data.data.list;

                        // å¦‚æœèœè°±æ•°é‡ä¸è¶³30ä¸ªï¼Œç”¨ç°æœ‰èœè°±é‡å¤å¡«å……
                        while (items.length < 30) {
                            // éšæœºé€‰æ‹©ç°æœ‰èœè°±æ·»åŠ åˆ°åˆ—è¡¨ä¸­
                            const randomIndex = Math.floor(Math.random() * res.data.data.list.length);
                            items.push(res.data.data.list[randomIndex]);
                        }

                        // åªå–å‰30ä¸ªä½œä¸ºæŠ½å¥–æ± 
                        this.lotteryItems = items.slice(0, 30);
                    } else {
                        alert(res.data.msg);
                    }
                });
            },
            startLottery() {
                if (this.isLotteryRunning || this.lotteryItems.length === 0) {
                    return;
                }

                this.isLotteryRunning = true;
                this.selectedFood = null;
                this.lotteryOffset = 0;

                // å®šä¹‰å¸¸é‡
                const itemWidth = 200; // æ¯ä¸ªå¡ç‰‡å®½åº¦
                const containerWidth = 1000; // å®¹å™¨å®½åº¦ï¼Œ5ä¸ªå¡ç‰‡
                const extraRounds = 3; // é¢å¤–è½¬åŠ¨3åœˆ

                // éšæœºé€‰æ‹©æœ€ç»ˆç»“æœ
                const finalIndex = Math.floor(Math.random() * this.lotteryItems.length);
                const finalFood = this.lotteryItems[finalIndex];

                // è®©ç›®æ ‡å¡ç‰‡åœåœ¨ä¸­é—´é‚£ä¸€è½®
                const middleIndex = this.lotteryItems.length; // ä¸­é—´é‚£ä¸€è½®çš„èµ·å§‹ç´¢å¼•
                const targetIndex = middleIndex + finalIndex; // ç›®æ ‡å¡ç‰‡åœ¨å¤§æ•°ç»„ä¸­çš„ç´¢å¼•
                const finalOffset = -(targetIndex * itemWidth) + (containerWidth / 2) - (itemWidth / 2);

                // åŠ¨ç”»å‚æ•°
                const duration = 3000; // 3ç§’ï¼Œå…ˆå¿«åæ…¢åœ
                const startTime = Date.now();
                const startOffset = 0;

                // å¢åŠ è½¬åŠ¨åœˆæ•°ï¼Œè®©æŠ½å¥–æ›´æœ‰è¶£å‘³æ€§
                const totalItems = this.lotteryItems.length;
                const extraDistance = extraRounds * totalItems * itemWidth;
                const distance = finalOffset - startOffset - extraDistance;

                // ç¼“åŠ¨å‡½æ•° - å…ˆå¿«åæ…¢
                const easeOutQuart = (t) => 1 - Math.pow(1 - t, 4);

                this.lotteryInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easedProgress = easeOutQuart(progress);

                    this.lotteryOffset = startOffset + (distance * easedProgress);

                    if (progress >= 1) {
                        clearInterval(this.lotteryInterval);
                        this.isLotteryRunning = false;
                        this.selectedFood = finalFood;

                        // æ˜¾ç¤ºç»“æœ
                        setTimeout(() => {
                            alert('ğŸ‰ æŠ½å¥–ç»“æŸï¼ä»Šå¤©åƒï¼š' + this.selectedFood.name);
                        }, 500);
                    }
                }, 16); // çº¦60fps
            },
            logout() {
                axios.get("/logout").then(res => {
                    if(res.data.code === '0') {
                        location.href = '/front/index.html';
                    } else {
                        msg('error', res.data.msg);
                    }
                })
            }
        }
    })
</script>
</body>
</html>
